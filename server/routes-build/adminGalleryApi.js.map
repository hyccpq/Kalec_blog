{"version":3,"sources":["../routes/adminGalleryApi.js"],"names":["controller","get","put","del","post","required","auth","admin","fileUpload","resData","saveNewGallery","savedGallery","deleteOneGallery","getAllGallery","updateImages","updateShowGallery","getQiniuToken","getOneGalleryImages","delSelectImage","editSelectImage","setCoverImage","AdminGalleryApi","body","query","createGallery","ctx","next","title","author","description","password","isPwd","request","e","toString","changeGallery","id","adSearchAllGallery","pageNum","pageSize","data","isManage","deleteGallery","showGallery","show","console","log","imageListInf","getGalleryImages","getUpdateToken","delImages","imageIds","editImages","imageId","imageDesc","imageName","setGalleryCover","imagePath"],"mappings":"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","sourcesContent":["import {\n  controller,\n  get,\n  put,\n  del,\n  post,\n  required,\n  auth,\n  admin,\n  fileUpload\n} from '../lib/decorator.js'\nimport { resData } from '../lib/util.js'\nimport {\n  saveNewGallery,\n  savedGallery,\n  deleteOneGallery,\n  getAllGallery,\n  updateImages,\n  updateShowGallery,\n  getQiniuToken,\n  getOneGalleryImages,\n  delSelectImage,\n  editSelectImage,\n  setCoverImage\n} from '../service/getAdminGallery.js'\n\n@controller('/api/gallery/v0')\nexport default class AdminGalleryApi {\n  static isManage = true\n\n  /**\n   * 相册相关\n   */\n  @post('/addGallery')\n  @auth\n  @admin('admin')\n  @required({\n    body: ['title', 'author', 'description', 'isPwd']\n  })\n  async createGallery(ctx, next) {\n    try {\n      const { title, author, description, password, isPwd } = ctx.request.body\n      await saveNewGallery(title, author, description, password, isPwd)\n      ctx.body = resData(1, '查询成功', {})\n    } catch (e) {\n      ctx.body = resData(0, '出现错误', e.toString())\n    }\n  }\n\n  @put('/editGallery')\n  @auth\n  @admin('admin')\n  @required({\n    body: ['id', 'title', 'author', 'description', 'isPwd']\n  })\n  async changeGallery(ctx, next) {\n    try {\n      const {\n        id,\n        title,\n        author,\n        description,\n        password,\n        isPwd\n      } = ctx.request.body\n      await savedGallery(id, title, author, description, password, isPwd)\n      ctx.body = resData(1, '修改成功', {})\n    } catch (e) {\n      ctx.body = resData(0, '出现错误', e.toString())\n    }\n  }\n\n  @get('/adSearchAllGallery')\n  @auth\n  async adSearchAllGallery(ctx, next) {\n    try {\n      const { pageNum, pageSize } = ctx.request.query\n      let data = await getAllGallery(AdminGalleryApi.isManage, {\n        pageNum,\n        pageSize\n      })\n      ctx.body = resData(1, '查询成功', data)\n    } catch (e) {\n      ctx.body = resData(0, '出现错误', e.toString())\n    }\n  }\n\n  @del('/deleteGallery')\n  @auth\n  @admin('admin')\n  @required({\n    query: ['id']\n  })\n  async deleteGallery(ctx, next) {\n    try {\n      const { id } = ctx.request.query\n      let data = await deleteOneGallery(id)\n      ctx.body = resData(1, '查询成功', data)\n    } catch (e) {\n      ctx.body = resData(0, '出现错误', e.toString())\n    }\n  }\n\n  @put('/showGallery')\n  @auth\n  @admin('admin')\n  @required({\n    body: ['id', 'show']\n  })\n  async showGallery(ctx, next) {\n    try {\n      const { id, show } = ctx.request.body\n      console.log(id, show)\n      let data = await updateShowGallery(id, show)\n      ctx.body = resData(1, '查询成功', data)\n    } catch (e) {\n      ctx.body = resData(0, '出现错误', e.toString())\n    }\n  }\n\n  @post('/updatedImages')\n  @auth\n  @admin('admin')\n  @required({\n    body: ['id', 'imageListInf']\n  })\n  async updateImages(ctx, next) {\n    try {\n      const { id, imageListInf } = ctx.request.body\n      let data = await updateImages(id, imageListInf)\n      ctx.body = resData(1, '查询成功', data)\n    } catch (e) {\n      ctx.body = resData(0, '出现错误', e.toString())\n    }\n  }\n\n  @get('/getGalleryImages')\n  @auth\n  @required({\n    query: ['id']\n  })\n  async getGalleryImages(ctx, next) {\n    try {\n      const { id } = ctx.request.query\n      let data = await getOneGalleryImages(id)\n      ctx.body = resData(1, '查询成功', data)\n    } catch (e) {\n      ctx.body = resData(0, '出现错误', e.toString())\n    }\n  }\n\n  @get('/getUpdateToken')\n  @auth\n  @admin('admin')\n  async getUpdateToken(ctx, next) {\n    try {\n      let data = getQiniuToken()\n      ctx.body = resData(1, '查询成功', data)\n    } catch (e) {\n      ctx.body = resData(0, '出现错误', e.toString())\n    }\n  }\n\n  @del('/images')\n  @auth\n  @admin('admin')\n  @required({\n    query: ['id', 'imageIds']\n  })\n  async delImages(ctx, next) {\n    try {\n      const { id, imageIds } = ctx.request.query\n      let data = await delSelectImage(id, imageIds)\n      ctx.body = resData(1, '查询成功', data)\n    } catch (e) {\n      ctx.body = resData(0, '出现错误', e.toString())\n    }\n  }\n\n  @put('/images')\n  @auth\n  @admin('admin')\n  @required({\n    body: ['id', 'imageId']\n  })\n  async editImages(ctx, next) {\n    try {\n      const { id, imageId, imageDesc, imageName, show } = ctx.request.body\n      let data = await editSelectImage(id, imageId, {\n        imageDesc,\n        imageName,\n        show\n      })\n      ctx.body = resData(1, '查询成功', data)\n    } catch (e) {\n      ctx.body = resData(0, '出现错误', e.toString())\n    }\n  }\n\n  @post('/cover')\n  @auth\n  @required({\n    body: ['id', 'imagePath']\n  })\n  async setGalleryCover(ctx, next) {\n    try {\n      const { id, imagePath } = ctx.request.body\n      let data = await setCoverImage(id, imagePath)\n      ctx.body = resData(1, '查询成功', data)\n    } catch (e) {\n      ctx.body = resData(0, '出现错误', e.toString())\n    }\n  }\n}\n"],"file":"adminGalleryApi.js"}